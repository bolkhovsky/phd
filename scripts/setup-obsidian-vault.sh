#!/bin/bash
# ะกะบัะธะฟั ะดะปั ัะพะทะดะฐะฝะธั ััััะบัััั Obsidian vault ะดะปั ัะฐะฑะพัั ะฝะฐะด ะดะธััะตััะฐัะธะตะน

set -e

VAULT_DIR="Obsidian-Vault"
SCRIPT_DIR="scripts"

echo "๐ ะกะพะทะดะฐะฝะธะต Obsidian vault ะดะปั ะดะธััะตััะฐัะธะธ..."

# ะกะพะทะดะฐะฝะธะต ะพัะฝะพะฒะฝะพะน ััััะบัััั
mkdir -p "$VAULT_DIR"/{00-ะะตัะฐะดะฐะฝะฝัะต,01-ะะฒะตะดะตะฝะธะต,02-ะะปะฐะฒะฐ-1,03-ะะปะฐะฒะฐ-2,04-ะะปะฐะฒะฐ-3,05-ะะฐะบะปััะตะฝะธะต,90-ะะฐะผะตัะบะธ,91-ะะธัะตัะฐัััะฐ,99-ะจะฐะฑะปะพะฝั}

echo "๐ ะกัััะบัััะฐ ะฟะฐะฟะพะบ ัะพะทะดะฐะฝะฐ"

# ะกะพะทะดะฐะฝะธะต .obsidian ะบะพะฝัะธะณััะฐัะธะธ
mkdir -p "$VAULT_DIR/.obsidian"

cat > "$VAULT_DIR/.obsidian/app.json" <<'EOF'
{
  "strictLineBreaks": true,
  "showLineNumber": true,
  "useMarkdownLinks": false,
  "newLinkFormat": "shortest",
  "attachmentFolderPath": "../images",
  "alwaysUpdateLinks": true
}
EOF

echo "โ๏ธ  ะะพะฝัะธะณััะฐัะธั Obsidian ัะพะทะดะฐะฝะฐ"

# ะกะพะทะดะฐะฝะธะต ัะฐะฑะปะพะฝะฐ ะดะปั ะปะธัะตัะฐัััะฝัั ะทะฐะผะตัะพะบ
cat > "$VAULT_DIR/99-ะจะฐะฑะปะพะฝั/Literature-Note-Template.md" <<'EOF'
---
title: "{{title}}"
authors: {{authorString}}
year: {{year}}
tags: [ะปะธัะตัะฐัััะฐ, {{citekey}}]
---

# {{title}}

**ะะฒัะพัั:** {{authorString}}
**ะะพะด:** {{year}}
**Citekey:** `{{citekey}}`

## ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั

{{abstract}}

## ะะปััะตะฒัะต ะธะดะตะธ

-

## ะะฐะถะฝัะต ัะธัะฐัั

>

## ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั ะฒ ะดะธััะตััะฐัะธะธ

- [ ] ะฃะฟะพะผัะฝััั ะฒะพ ะฒะฒะตะดะตะฝะธะธ (ะฐะบััะฐะปัะฝะพััั)
- [ ] ะฆะธัะธัะพะฒะฐัั ะฒ ะณะปะฐะฒะต:
- [ ] ะะพะฑะฐะฒะธัั ะฒ ะพะฑะทะพั ะปะธัะตัะฐัััั

## ะกะฒัะทะฐะฝะฝัะต ัะฐะฑะพัั

-

## ะะฐะผะตัะบะธ


EOF

# ะกะพะทะดะฐะฝะธะต ัะฐะฑะปะพะฝะฐ ะดะปั ัะฐะทะดะตะปะฐ
cat > "$VAULT_DIR/99-ะจะฐะฑะปะพะฝั/Section-Template.md" <<'EOF'
---
section:
chapter:
title:
status: draft
created: {{date}}
---

# {{title}}

## ะกะพะดะตัะถะฐะฝะธะต ัะฐะทะดะตะปะฐ

ะะฐะฟะธัะธัะต ะพัะฝะพะฒะฝะพะต ัะพะดะตัะถะฐะฝะธะต ะทะดะตัั...

## ะกะฒัะทะฐะฝะฝัะต ัะฐะทะดะตะปั

- [[]]

## ะะธัะตัะฐัััะฐ

- [@]

---

**LaTeX ัะฐะนะป:** `Dissertation/partX.tex`
**ะกัะฐััั:** {{status}}
EOF

# ะกะพะทะดะฐะฝะธะต README ะดะปั vault
cat > "$VAULT_DIR/README.md" <<'EOF'
# Obsidian Vault ะดะปั ะดะธััะตััะฐัะธะธ

ะญัะพั vault ะธัะฟะพะปัะทัะตััั ะดะปั ะฝะฐะฟะธัะฐะฝะธั ะดะธััะตััะฐัะธะธ ะฒ ัะดะพะฑะฝะพะผ markdown-ัะพัะผะฐัะต.

## ะกัััะบัััะฐ

- `00-ะะตัะฐะดะฐะฝะฝัะต/` โ ะดะฐะฝะฝัะต ะพ ะดะธััะตััะฐัะธะธ, ะฐะฒัะพัะต, ะฝะฐััะฝะพะผ ััะบะพะฒะพะดะธัะตะปะต
- `01-ะะฒะตะดะตะฝะธะต/` โ ะฒะฒะตะดะตะฝะธะต ะดะธััะตััะฐัะธะธ
- `02-ะะปะฐะฒะฐ-1/` โ ะฟะตัะฒะฐั ะณะปะฐะฒะฐ
- `03-ะะปะฐะฒะฐ-2/` โ ะฒัะพัะฐั ะณะปะฐะฒะฐ
- `04-ะะปะฐะฒะฐ-3/` โ ััะตััั ะณะปะฐะฒะฐ
- `05-ะะฐะบะปััะตะฝะธะต/` โ ะทะฐะบะปััะตะฝะธะต
- `90-ะะฐะผะตัะบะธ/` โ ัะฐะฑะพัะธะต ะทะฐะผะตัะบะธ, ะธะดะตะธ
- `91-ะะธัะตัะฐัััะฐ/` โ ะทะฐะผะตัะบะธ ะพ ะปะธัะตัะฐัััะฝัั ะธััะพัะฝะธะบะฐั
- `99-ะจะฐะฑะปะพะฝั/` โ ัะฐะฑะปะพะฝั ะดะปั ะฝะพะฒัั ะทะฐะผะตัะพะบ

## ะะตะบะพะผะตะฝะดัะตะผัะต ะฟะปะฐะณะธะฝั

1. **Citations** โ ะดะปั ัะฐะฑะพัั ั ะฑะธะฑะปะธะพะณัะฐัะธะตะน ะธะท .bib ัะฐะนะปะพะฒ
2. **Templater** โ ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะฐะฑะปะพะฝะพะฒ
3. **Dataview** โ ะดะปั ัะพะทะดะฐะฝะธั ะดะธะฝะฐะผะธัะตัะบะธั ัะฟะธัะบะพะฒ
4. **Obsidian Git** โ ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ัะธะฝััะพะฝะธะทะฐัะธะธ
5. **Advanced Tables** โ ะดะปั ัะดะพะฑะฝะพะน ัะฐะฑะพัั ั ัะฐะฑะปะธัะฐะผะธ
6. **Paste Image Rename** โ ะดะปั ะฒััะฐะฒะบะธ ะธะทะพะฑัะฐะถะตะฝะธะน

## ะะฐัััะพะนะบะฐ Citations plugin

Settings โ Community plugins โ Citations โ Options:

```
Citation database format: BibLaTeX
Citation database path: ../biblio/author.bib,../biblio/external.bib
Literature note folder: 91-ะะธัะตัะฐัััะฐ
Literature note template: 99-ะจะฐะฑะปะพะฝั/Literature-Note-Template.md
```

## Workflow

1. ะะธัะธัะต ะบะพะฝัะตะฝั ะฒ markdown ัะฐะนะปะฐั
2. ะัะฟะพะปัะทัะนัะต `[@citekey]` ะดะปั ัะธัะธัะพะฒะฐะฝะธั
3. ะญะบัะฟะพััะธััะนัะต ะณะพัะพะฒัะต ัะฐะทะดะตะปั ะฒ LaTeX: `../scripts/obsidian-to-latex.sh`
4. ะะพะผะฟะธะปะธััะนัะต ะดะธััะตััะฐัะธั: `make dissertation`

## ะะพะบัะผะตะฝัะฐัะธั

ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ: [Readme/Obsidian-Workflow.md](../Readme/Obsidian-Workflow.md)
EOF

# ะกะพะทะดะฐะฝะธะต ะฟัะธะผะตัะฐ ัะฐะนะปะฐ ะผะตัะฐะดะฐะฝะฝัั
cat > "$VAULT_DIR/00-ะะตัะฐะดะฐะฝะฝัะต/ะะฐะฝะฝัะต-ะดะธััะตััะฐัะธะธ.md" <<'EOF'
---
tags: [meta, config]
---

# ะะตัะฐะดะฐะฝะฝัะต ะดะธััะตััะฐัะธะธ

> ะญัะธ ะดะฐะฝะฝัะต ะธัะฟะพะปัะทััััั ะดะปั ะณะตะฝะตัะฐัะธะธ `common/data.tex`

## ะัะฝะพะฒะฝัะต ัะฒะตะดะตะฝะธั

**ะะฒัะพั (ะคะฐะผะธะปะธั):**
**ะะฒัะพั (ะะผั ะััะตััะฒะพ):**
**ะะฝะธัะธะฐะปั:**

**ะะฐะทะฒะฐะฝะธะต ะดะธััะตััะฐัะธะธ:**


**ะกะฟะตัะธะฐะปัะฝะพััั (ะฝะพะผะตั):**
**ะกะฟะตัะธะฐะปัะฝะพััั (ะฝะฐะทะฒะฐะฝะธะต):**


**ะฃััะฝะฐั ััะตะฟะตะฝั:** ะบะฐะฝะดะธะดะฐัะฐ ัะธะทะธะบะพ-ะผะฐัะตะผะฐัะธัะตัะบะธั ะฝะฐัะบ
**ะฃััะฝะฐั ััะตะฟะตะฝั (ะบัะฐัะบะพ):** ะบะฐะฝะด. ัะธะท.-ะผะฐั. ะฝะฐัะบ

**ะะพัะพะด:**
**ะะพะด:** 2025

**ะัะณะฐะฝะธะทะฐัะธั:**


## ะะฐััะฝัะน ััะบะพะฒะพะดะธัะตะปั

**ะคะะ:**

## ะะฟะฟะพะฝะตะฝัั

1.
2.

## ะะตะดััะฐั ะพัะณะฐะฝะธะทะฐัะธั



---

**ะกะธะฝััะพะฝะธะทะฐัะธั:**
ะะพัะปะต ะทะฐะฟะพะปะฝะตะฝะธั ะพะฑะฝะพะฒะธัะต ัะฐะนะป `../common/data.tex`
EOF

# ะกะพะทะดะฐะฝะธะต Dashboard
cat > "$VAULT_DIR/00-ะะตัะฐะดะฐะฝะฝัะต/Dashboard.md" <<'EOF'
---
tags: [dashboard, progress]
---

# ๐ Dashboard ะดะธััะตััะฐัะธะธ

## ะััััะฐั ะฝะฐะฒะธะณะฐัะธั

- [[ะะฐะฝะฝัะต-ะดะธััะตััะฐัะธะธ]] โ ะผะตัะฐะดะฐะฝะฝัะต
- [[../01-ะะฒะตะดะตะฝะธะต/ะะฒะตะดะตะฝะธะต]] โ ะฒะฒะตะดะตะฝะธะต
- [[../02-ะะปะฐะฒะฐ-1/00-ะะปะฐะฒะฐ-1-ะะปะฐะฒะฝะฐั]] โ ะณะปะฐะฒะฐ 1
- [[../03-ะะปะฐะฒะฐ-2/00-ะะปะฐะฒะฐ-2-ะะปะฐะฒะฝะฐั]] โ ะณะปะฐะฒะฐ 2
- [[../04-ะะปะฐะฒะฐ-3/00-ะะปะฐะฒะฐ-3-ะะปะฐะฒะฝะฐั]] โ ะณะปะฐะฒะฐ 3
- [[../05-ะะฐะบะปััะตะฝะธะต/ะะฐะบะปััะตะฝะธะต]] โ ะทะฐะบะปััะตะฝะธะต

## TODO

- [ ] ะะฐะฟะพะปะฝะธัั ะผะตัะฐะดะฐะฝะฝัะต ะดะธััะตััะฐัะธะธ
- [ ] ะะฐะฟะธัะฐัั ะฒะฒะตะดะตะฝะธะต
- [ ] ะะฐะฒะตััะธัั ะณะปะฐะฒั 1
- [ ] ะะพะฑะฐะฒะธัั ัะธััะฝะบะธ ะฒ ะณะปะฐะฒั 2
- [ ] ะัะพะฒะตัะธัั ัะธัะธัะพะฒะฐะฝะธะต
- [ ] ะญะบัะฟะพััะธัะพะฒะฐัั ะฒ LaTeX
- [ ] ะกะบะพะผะฟะธะปะธัะพะฒะฐัั ะดะธััะตััะฐัะธั

## ะกัะฐัะธััะธะบะฐ

**ะะปะฐะฒ:** 3
**ะกัะฐััั:** ะ ัะฐะฑะพัะต
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** {{date}}

## ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะญะบัะฟะพัั ะฒ LaTeX
../scripts/obsidian-to-latex.sh

# ะะพะผะฟะธะปััะธั
cd .. && make dissertation

# ะัะพัะผะพัั PDF
evince dissertation.pdf
```
EOF

echo "๐ ะจะฐะฑะปะพะฝั ะธ ะฟัะธะผะตัั ัะพะทะดะฐะฝั"

# ะกะพะทะดะฐะฝะธะต .gitignore ะดะปั vault
cat > "$VAULT_DIR/.gitignore" <<'EOF'
# Obsidian
.obsidian/workspace*
.obsidian/cache
.trash/

# ะัะตะผะตะฝะฝัะต ัะฐะนะปั
*.tmp
*.bak
*~
EOF

echo "๐ง ะกะพะทะดะฐะฝะธะต ัะบัะธะฟัะฐ ัะบัะฟะพััะฐ..."

# ะกะพะทะดะฐะฝะธะต ัะบัะธะฟัะฐ ัะบัะฟะพััะฐ Obsidian โ LaTeX
mkdir -p "$SCRIPT_DIR"

cat > "$SCRIPT_DIR/obsidian-to-latex.sh" <<'EOF'
#!/bin/bash
# ะะพะฝะฒะตััะฐัะธั markdown ัะฐะนะปะพะฒ ะธะท Obsidian ะฒ LaTeX

set -e

VAULT="/home/user/phd/Obsidian-Vault"
OUTPUT="/home/user/phd/Dissertation"

if [ ! -d "$VAULT" ]; then
    echo "โ Vault ะฝะต ะฝะฐะนะดะตะฝ: $VAULT"
    exit 1
fi

echo "๐ ะะพะฝะฒะตััะฐัะธั Obsidian โ LaTeX..."

# ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั pandoc
if ! command -v pandoc &> /dev/null; then
    echo "โ Pandoc ะฝะต ัััะฐะฝะพะฒะปะตะฝ. ะฃััะฐะฝะพะฒะธัะต: sudo apt install pandoc"
    exit 1
fi

# ะคัะฝะบัะธั ะดะปั ะบะพะฝะฒะตััะฐัะธะธ ะณะปะฐะฒั
convert_chapter() {
    local chapter=$1
    local output=$2

    if [ -d "$VAULT/$chapter" ]; then
        echo "  โ ะะฑัะฐะฑะพัะบะฐ $chapter..."
        pandoc "$VAULT/$chapter"/*.md \
            -f markdown+citations \
            -t latex \
            --biblatex \
            --bibliography=biblio/author.bib \
            --bibliography=biblio/external.bib \
            -o "$OUTPUT/$output" 2>/dev/null || echo "    โ๏ธ  ะัะตะดัะฟัะตะถะดะตะฝะธะต ะฟัะธ ะบะพะฝะฒะตััะฐัะธะธ $chapter"
    else
        echo "  โญ๏ธ  ะัะพะฟััะบ $chapter (ะฟะฐะฟะบะฐ ะฝะต ะฝะฐะนะดะตะฝะฐ)"
    fi
}

# ะะพะฝะฒะตััะฐัะธั ะณะปะฐะฒ
convert_chapter "02-ะะปะฐะฒะฐ-1" "part1.tex"
convert_chapter "03-ะะปะฐะฒะฐ-2" "part2.tex"
convert_chapter "04-ะะปะฐะฒะฐ-3" "part3.tex"

# ะะพะฝะฒะตััะฐัะธั ะฒะฒะตะดะตะฝะธั
if [ -f "$VAULT/01-ะะฒะตะดะตะฝะธะต/ะะฒะตะดะตะฝะธะต.md" ]; then
    echo "  โ ะะฑัะฐะฑะพัะบะฐ ะะฒะตะดะตะฝะธั..."
    pandoc "$VAULT/01-ะะฒะตะดะตะฝะธะต/ะะฒะตะดะตะฝะธะต.md" \
        -f markdown+citations \
        -t latex \
        --biblatex \
        --bibliography=biblio/author.bib \
        --bibliography=biblio/external.bib \
        -o "$OUTPUT/introduction-content.tex" 2>/dev/null || echo "    โ๏ธ  ะัะตะดัะฟัะตะถะดะตะฝะธะต ะฟัะธ ะบะพะฝะฒะตััะฐัะธะธ ะะฒะตะดะตะฝะธั"
fi

# ะะพะฝะฒะตััะฐัะธั ะทะฐะบะปััะตะฝะธั
if [ -f "$VAULT/05-ะะฐะบะปััะตะฝะธะต/ะะฐะบะปััะตะฝะธะต.md" ]; then
    echo "  โ ะะฑัะฐะฑะพัะบะฐ ะะฐะบะปััะตะฝะธั..."
    pandoc "$VAULT/05-ะะฐะบะปััะตะฝะธะต/ะะฐะบะปััะตะฝะธะต.md" \
        -f markdown+citations \
        -t latex \
        --biblatex \
        --bibliography=biblio/author.bib \
        --bibliography=biblio/external.bib \
        -o "$OUTPUT/conclusion-content.tex" 2>/dev/null || echo "    โ๏ธ  ะัะตะดัะฟัะตะถะดะตะฝะธะต ะฟัะธ ะบะพะฝะฒะตััะฐัะธะธ ะะฐะบะปััะตะฝะธั"
fi

echo "โ ะะพะฝะฒะตััะฐัะธั ะทะฐะฒะตััะตะฝะฐ!"
echo ""
echo "๐ ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั:"
echo "   - $OUTPUT/part1.tex"
echo "   - $OUTPUT/part2.tex"
echo "   - $OUTPUT/part3.tex"
echo ""
echo "๐ก ะกะปะตะดัััะธะต ัะฐะณะธ:"
echo "   1. ะัะพะฒะตัััะต ะธ ะฐะดะฐะฟัะธััะนัะต LaTeX ัะฐะนะปั"
echo "   2. ะกะบะพะผะฟะธะปะธััะนัะต ะดะธััะตััะฐัะธั: make dissertation"
EOF

chmod +x "$SCRIPT_DIR/obsidian-to-latex.sh"

echo "โ ะกะบัะธะฟั ัะบัะฟะพััะฐ ัะพะทะดะฐะฝ: $SCRIPT_DIR/obsidian-to-latex.sh"

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ Obsidian vault ััะฟะตัะฝะพ ัะพะทะดะฐะฝ!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ะกัััะบัััะฐ:"
echo "   $VAULT_DIR/"
echo "   โโโ 00-ะะตัะฐะดะฐะฝะฝัะต/    (ะดะฐะฝะฝัะต ะพ ะดะธััะตััะฐัะธะธ)"
echo "   โโโ 01-ะะฒะตะดะตะฝะธะต/      (ะฒะฒะตะดะตะฝะธะต)"
echo "   โโโ 02-ะะปะฐะฒะฐ-1/       (ะณะปะฐะฒะฐ 1)"
echo "   โโโ 03-ะะปะฐะฒะฐ-2/       (ะณะปะฐะฒะฐ 2)"
echo "   โโโ 04-ะะปะฐะฒะฐ-3/       (ะณะปะฐะฒะฐ 3)"
echo "   โโโ 05-ะะฐะบะปััะตะฝะธะต/    (ะทะฐะบะปััะตะฝะธะต)"
echo "   โโโ 90-ะะฐะผะตัะบะธ/       (ัะฐะฑะพัะธะต ะทะฐะผะตัะบะธ)"
echo "   โโโ 91-ะะธัะตัะฐัััะฐ/    (ะปะธัะตัะฐัััะฝัะต ะธััะพัะฝะธะบะธ)"
echo "   โโโ 99-ะจะฐะฑะปะพะฝั/       (ัะฐะฑะปะพะฝั ะทะฐะผะตัะพะบ)"
echo ""
echo "๐ ะกะปะตะดัััะธะต ัะฐะณะธ:"
echo "   1. ะัะบัะพะนัะต Obsidian โ Open folder as vault โ ะฒัะฑะตัะธัะต $VAULT_DIR/"
echo "   2. ะฃััะฐะฝะพะฒะธัะต ัะตะบะพะผะตะฝะดัะตะผัะต ะฟะปะฐะณะธะฝั (Citations, Templater, etc.)"
echo "   3. ะะฐัััะพะนัะต Citations plugin (ะฟััั ะบ .bib: ../biblio/author.bib)"
echo "   4. ะะฐัะฝะธัะต ะฟะธัะฐัั ะบะพะฝัะตะฝั ะฒ markdown"
echo "   5. ะญะบัะฟะพััะธััะนัะต ะฒ LaTeX: ./scripts/obsidian-to-latex.sh"
echo "   6. ะะพะผะฟะธะปะธััะนัะต ะดะธััะตััะฐัะธั: make dissertation"
echo ""
echo "๐ ะะพะบัะผะตะฝัะฐัะธั:"
echo "   Readme/Obsidian-Workflow.md โ ะฟะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ"
echo ""
